<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Cooking - Where I Cook and You Watch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .welcome-screen {
            text-align: center;
            padding: 40px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }
        
        .welcome-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .welcome-screen p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #666;
        }
        
        .start-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            background-color: #222;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .start-btn:hover {
            background-color: #000;
        }
        
        .chat-container {
            width: 100%;
            max-width: 1000px;
            height: 80vh;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background-color: #222;
            color: white;
            padding: 15px 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 15px;
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .bot-message {
            background-color: #F0F0F0;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background-color: #222;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .chat-input-container {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        
        .chat-input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            margin-right: 10px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #222;
        }
        
        .btn {
            padding: 12px 15px;
            background-color: #222;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background-color: #000;
        }
        
        .send-btn {
            padding: 12px 25px;
            margin-right: 10px;
        }
        
        .mic-btn {
            width: 48px;
            height: 48px;
        }
        
        .mic-btn.recording {
            background-color: #CC0000;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: #F0F0F0;
            padding: 12px 18px;
            border-radius: 15px;
            border-bottom-left-radius: 5px;
            margin-bottom: 10px;
        }
        
        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #999;
            margin-right: 3px;
            animation: wave 1.3s linear infinite;
        }
        
        .dot:nth-child(2) {
            animation-delay: -1.1s;
        }
        
        .dot:nth-child(3) {
            animation-delay: -0.9s;
        }
        
        @keyframes wave {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        /* Recording modal styles */
        .recording-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .recording-modal {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .recording-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #333;
            font-weight: bold;
        }
        
        .recording-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .recording-wave {
            display: flex;
            align-items: center;
            height: 60px;
        }
        
        .wave-bar {
            width: 5px;
            height: 20px;
            margin: 0 2px;
            background-color: #CC0000;
            border-radius: 3px;
            animation: wave-animation 1s infinite ease-in-out;
        }
        
        @keyframes wave-animation {
            0%, 100% {
                height: 20px;
            }
            50% {
                height: 50px;
            }
        }
        
        .wave-bar:nth-child(2) {
            animation-delay: 0.1s;
        }
        .wave-bar:nth-child(3) {
            animation-delay: 0.2s;
        }
        .wave-bar:nth-child(4) {
            animation-delay: 0.3s;
        }
        .wave-bar:nth-child(5) {
            animation-delay: 0.4s;
        }
        
        .recording-transcript {
            min-height: 60px;
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            color: #666;
            text-align: left;
        }
        
        .recording-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .recording-btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        
        .cancel-btn {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .send-recording-btn {
            background-color: #222;
            color: white;
        }
        
        .send-recording-btn:hover {
            background-color: #000;
        }
        
        .cancel-btn:hover {
            background-color: #e5e5e5;
        }
        
        @media (max-width: 768px) {
            .welcome-screen {
                padding: 30px;
            }
            
            .welcome-screen h1 {
                font-size: 2rem;
            }
            
            .message {
                max-width: 85%;
            }
            
            .recording-modal {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen (Step 1) -->
        <div class="welcome-screen" id="welcomeScreen">
            <h1>Welcome to Browser Cooking</h1>
            <p>Where I Cook and You Watch</p>
            <button class="start-btn" id="startBtn">START COOKING</button>
        </div>
        
        <!-- Chat Screen (Step 2) -->
        <div class="chat-container" id="chatContainer" style="display: none;">
            <div class="chat-header">Browser Cooking Assistant</div>
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be added here dynamically -->
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me to cook something...">
                <button class="btn send-btn" id="sendBtn">Send</button>
                <button class="btn mic-btn" id="micBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Recording Modal -->
        <div class="recording-overlay" id="recordingOverlay">
            <div class="recording-modal">
                <div class="recording-title">Recording your message...</div>
                <div class="recording-indicator">
                    <div class="recording-wave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>
                <div class="recording-transcript" id="recordingTranscript">Listening...</div>
                <div class="recording-buttons">
                    <button class="recording-btn cancel-btn" id="cancelRecordingBtn">Cancel</button>
                    <button class="recording-btn send-recording-btn" id="sendRecordingBtn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const startBtn = document.getElementById('startBtn');
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const micBtn = document.getElementById('micBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Recording modal elements
        const recordingOverlay = document.getElementById('recordingOverlay');
        const recordingTranscript = document.getElementById('recordingTranscript');
        const cancelRecordingBtn = document.getElementById('cancelRecordingBtn');
        const sendRecordingBtn = document.getElementById('sendRecordingBtn');

        // Speech Recognition Setup
        let recognition;
        let isRecording = false;
        let recordedText = '';

        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();

                recognition.continuous = false; // Changed to false to avoid issues with permissions
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    isRecording = true;
                    micBtn.classList.add('recording');
                    recordingTranscript.textContent = 'Listening...';
                };

                recognition.onresult = function(event) {
                    let interimTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            recordedText += event.results[i][0].transcript + ' ';
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }

                    recordingTranscript.textContent = recordedText + interimTranscript;
                };

                recognition.onend = function() {
                    // Don't automatically restart to avoid permission loop issues
                    console.log("Recognition ended");
                };

               recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);

                    if (event.error === 'not-allowed') {
                        recordingTranscript.textContent = "Microphone access denied. Please enable microphone access in your browser settings.";
                        isRecording = false;
                        micBtn.classList.remove('recording');
                    } else {
                        recordingTranscript.textContent = "Error: " + event.error + ". Please try again.";
                    }
                };

                return true;
            } else {
                console.error("Speech recognition not supported in this browser");
                return false;
            }
        }


        // Event Listeners
        startBtn.addEventListener('click', startCooking);
        sendBtn.addEventListener('click', sendMessage);
        micBtn.addEventListener('click', startRecording);
        cancelRecordingBtn.addEventListener('click', cancelRecording);
        sendRecordingBtn.addEventListener('click', sendRecordedMessage);
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechRecognition();
        });

        // Functions
        function startCooking() {
            welcomeScreen.style.display = 'none';
            chatContainer.style.display = 'flex';
            
            // Add initial bot message
            setTimeout(() => {
                addBotMessage("Hello! 👨‍🍳 I'm your Browser Cooking Assistant. What would you like me to cook for you today? You can type or use the microphone button to speak.");
            }, 500);
        }

        function startRecording() {
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    addBotMessage("Sorry, voice recognition is not supported in your browser. Please try using a different browser like Chrome.");
                    return;
                }
            }

            try {
                // Reset recording state
                isRecording = true;
                recordedText = '';

                // Show recording modal
                recordingOverlay.style.display = 'flex';

                // Start recording
                recognition.start();
            } catch (error) {
                console.error("Speech recognition error:", error);
                recordingTranscript.textContent = "Error starting recording. Please try again.";
                isRecording = false;
            }
        }


        function cancelRecording() {
            if (isRecording) {
                isRecording = false;
                micBtn.classList.remove('recording');
                try {
                    recognition.stop();
                } catch (error) {
                    console.error("Error stopping recognition:", error);
                }
            }

            // Hide recording modal
            recordingOverlay.style.display = 'none';
        }

        function sendRecordedMessage() {
           const messageText = recordedText.trim() || recordingTranscript.textContent.trim();
                
           if (messageText && messageText !== 'Listening...' && !messageText.includes('Error')) {
                // Transfer recorded text to input
                chatInput.value = messageText;
                
                // Send the message
               sendMessage();
            }
        
           // Stop recording
           if (isRecording) {
                isRecording = false;
               micBtn.classList.remove('recording');
                try {
                    recognition.stop();
                } catch (error) {
                    console.error("Error stopping recognition:", error);
                }
            }
        
            // Hide recording modal
            recordingOverlay.style.display = 'none';
        }       

        function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            // Add user message
            addUserMessage(message);
            chatInput.value = '';
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            
            // Simulate AI response (will be replaced with actual AI integration)
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                
                // Example responses (will be replaced with AI responses)
                let response;
                const lowerMsg = message.toLowerCase();
                
                if (lowerMsg.includes('hello') || lowerMsg.includes('hi')) {
                    response = "Hello there! What can I cook for you today?";
                } 
                else if (lowerMsg.includes('pasta') || lowerMsg.includes('spaghetti')) {
                    response = "Ah, pasta! A wonderful choice. I'd recommend a classic spaghetti carbonara or perhaps a creamy mushroom pasta. Which would you prefer?";
                }
                else if (lowerMsg.includes('cake') || lowerMsg.includes('dessert')) {
                    response = "Desserts are my specialty! How about a chocolate lava cake or a fresh berry cheesecake?";
                }
                else if (lowerMsg.includes('help') || lowerMsg.includes('what can you do')) {
                    response = "I can help you discover recipes, give cooking tips, or walk through step-by-step cooking instructions. Just tell me what you'd like to cook or learn about!";
                }
                else {
                    response = "I understand you're interested in " + message + ". I'd be happy to help you with this recipe or suggest alternatives. What specific questions do you have about preparing it?";
                }
                
                addBotMessage(response);
            }, 1000 + Math.random() * 1000); // Random delay between 1-2 seconds
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addBotMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>